{% extends 'base.html' %} {% block title %} – {{ post.titulo }}{% endblock %}
{%block content %}
<div class="row justify-content-center">
  <div class="col-lg-9">
    <!-- Cabeçalho do Post -->
    <article class="bg-white rounded shadow-md p-4 p-md-5 mb-4">
      <header class="mb-4">
        <h1 class="display-5 fw-bold mb-3">{{ post.titulo }}</h1>
        <div class="d-flex flex-wrap align-items-center gap-3 text-muted mb-4">
          <div class="d-flex align-items-center">
            <i class="fa-regular fa-user"></i>
            <span class="ms-2"><strong>{{post.autor.get_full_name|default:post.autor.username}}</strong></span>
          </div>
          <div class="d-flex align-items-center">
            <i class="fa-solid fa-calendar-days"></i>
            <span class="ms-1">{{ post.publicado_em|date:"d \\d\\e F \\d\\e Y" }}</span>
          </div>
          {% if post.categoria %}
          <div class="d-flex align-items-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-folder me-2"
              viewBox="0 0 16 16"
            >
              <path
                d="M.5 3l.04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9.81a2 2 0 0 0 1.991-1.819l.637-7a1.99 1.99 0 0 0-.342-1.311L12.5 3H.5zm.217 1h11.566l-.285 3.143a1 1 0 0 1-.997.857H2.826a1 1 0 0 1-.997-.857L1.717 4z"
              />
            </svg>
            <a
              href="{{ post.categoria.get_absolute_url }}"
              class="text-decoration-none text-primary fw-semibold"
              >{{ post.categoria }}</a
            >
          </div>
          {% endif %}
        </div>
      </header>

      <!-- Imagem do Post -->
      {% if post.imagem %}
      <div class="mb-4">
        <img
          src="{{ post.imagem.url }}"
          class="img-fluid rounded shadow-sm"
          alt="{{ post.titulo }}"
          style="max-height: 500px; width: 100%; object-fit: cover"
        />
      </div>
      {% endif %}

      <!-- Conteúdo do Post -->
      <div
        class="post-content mb-5"
        style="font-size: 1.1rem; line-height: 1.8"
      >
        {{ post.conteudo|linebreaks }}
      </div>

      <!-- Tags -->
      <div class="border-top pt-4 mb-2">
        <div class="d-flex flex-wrap align-items-center gap-2">
          <strong class="mb-2 me-2">Tags:</strong>
          {% for tag in post.tags.all %}
          <a
            href="{{ tag.get_absolute_url }}"
            class="badge bg-primary text-decoration-none px-3 py-2"
            >{{ tag }}</a
          >
          {% empty %}
          <span class="text-muted mb-2">Sem tags</span>
          {% endfor %}
        </div>
      </div>
      {% if user == post.autor %}
      <form
        method="post"
        action="{% url 'blog:post_delete' post.pk %}"
        class="d-inline"
        onsubmit="return confirm('Tem certeza que deseja excluir este post?');"
      >
        {% csrf_token %}
        <button type="submit" class="btn btn-danger btn-sm">
          <i class="fas fa-trash"></i> Excluir Post
        </button>
      </form>
      {% endif %}
    </article>

    <!-- Seção de Comentários -->
    <div class="bg-white rounded shadow-sm mb-4 p-6 p-md-4">
      <h3 class="mb-4 pb-3 border-bottom">
        <i class="fa-solid fa-comments"></i>
        Seção de Comentários {% if comentarios_aprovados.count == 1 %} (1 comentário) 
        {% elif comentarios_aprovados.count > 1 %} 
        ({{ comentarios_aprovados.count }} comentários) 
        {% else %} 
        <p class="text-muted mt-3 mb-2">(Nenhum comentário)</p> 
        {% endif %}
      </h3>
    </div>
    <div class="bg-white rounded shadow-sm p-4 p-md-5">
      <!-- Comentários Aprovados -->
      {% if comentarios_aprovados %}
      <div class="mb-5">
        <h4 class="mb-4">Comentários ({{ comentarios_aprovados.count }})</h4>
        <div class="list-group">
          {% for comentario in comentarios_aprovados %}
          <div class="list-group-item border-0 border-bottom pb-3 mb-3">
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <h6 class="mb-1 fw-semibold">{{ comentario.nome }}</h6>
                <small class="text-muted d-block mb-2"
                  >{{ comentario.criado_em|date:"d \\d\\e F \\d\\e Y \\à\\s H:i"}}</small>
                <p class="mb-0">{{ comentario.mensagem|linebreaks }}</p>
              </div>
              {% if user == post.autor %}
              <form method="post" action="{% url 'blog:delete_comment' comentario.id %}" class="d-inline ms-3" onsubmit="return confirm('Tem certeza que deseja excluir este comentário?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger" title="Excluir comentário">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </form>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <h3 class="mb-4 pb-3 border-bottom">
        <i class="fa-solid fa-book"></i>
        Deixe seu comentário
      </h3>
      <form method="post" class="mt-4">
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-md-6">
            <label for="nome" class="form-label fw-semibold"
              >Nome <span class="text-danger">*</span></label
            >
            <input
              type="text"
              name="nome"
              id="nome"
              class="form-control form-control-lg"
              placeholder="Seu nome"
              required
            />
          </div>
          <div class="col-md-6">
            <label for="email" class="form-label fw-semibold"
              >E-mail <span class="text-danger">*</span></label
            >
            <input
              type="email"
              name="email"
              id="email"
              class="form-control form-control-lg"
              placeholder="seu@email.com"
              required
            />
            <small class="text-muted">Não será publicado</small>
          </div>
          <div class="col-12">
            <label for="mensagem" class="form-label fw-semibold"
              >Mensagem <span class="text-danger">*</span></label
            >
            <textarea
              name="mensagem"
              id="mensagem"
              class="form-control form-control-lg"
              rows="6"
              placeholder="Escreva seu comentário aqui..."
              required
            ></textarea>
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-primary btn-lg px-5">
              <i class="fa-solid fa-paper-plane"></i> Enviar comentário
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
