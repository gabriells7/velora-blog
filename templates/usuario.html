{% extends 'base.html' %} {% block title %} – Perfil do Usuário{% endblock %}
{%block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">
    <!-- Cabeçalho do Perfil -->
    <div class="bg-white rounded shadow-sm p-4 p-md-5 mb-4">
      <div
        class="d-flex flex-column flex-md-row align-items-center align-items-md-start gap-4"
      >
        <div class="text-center text-md-start">
          <div
            class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center"
            style="width: 100px; height: 100px; font-size: 2.5rem"
          >
            {{ user.username|first|upper }}
          </div>
        </div>
        <div class="flex-grow-1 text-center text-md-start">
          <h1 class="display-6 fw-bold mb-2">
            {{ user.get_full_name|default:user.username }}
          </h1>
          <p class="text-muted mb-3">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-envelope me-1"
              viewBox="0 0 16 16"
            >
              <path
                d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"
              />
            </svg>
            {{ user.email }}
          </p>
          <div
            class="d-flex flex-wrap gap-3 justify-content-center justify-content-md-start"
          >
            <div class="badge bg-primary px-3 py-2">
              <i class="fa-solid fa-mobile-screen"></i>
              {{ total_posts_publicados }} Posts Publicados
            </div>
            <div class="badge bg-warning text-dark px-3 py-2">
              <i class="fa-solid fa-file-circle-plus"></i>
              {{ total_posts_rascunhos }} Rascunhos
            </div>
            <div class="badge bg-danger px-3 py-2">
              <i class="fa-solid fa-file-circle-exclamation"></i>
              {{ total_comentarios_pendentes }} Comentários Pendentes
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Posts Publicados -->
    <div class="bg-white rounded shadow-sm p-4 p-md-5 mb-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="h4 fw-bold mb-0">
          <i class="fa-solid fa-mobile-screen"></i>
          Posts Publicados
        </h2>
      </div>
      {% if posts_publicados %}
      <div class="list-group">
        {% for post in posts_publicados %}
        <a
          href="{{ post.get_absolute_url }}"
          class="list-group-item list-group-item-action"
        >
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ post.titulo }}</h5>
            <small class="text-muted"
              >{{ post.publicado_em|date:"d/m/Y" }}</small
            >
          </div>
          <p class="mb-1 text-muted">{{ post.conteudo|truncatewords:20 }}</p>
          {% if post.categoria %}
          <small class="text-primary">{{ post.categoria }}</small>
          {% endif %}
        </a>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-muted text-center py-4">
        Você ainda não publicou nenhum post.
      </p>
      {% endif %}
    </div>

    <!-- Rascunhos -->
    <div class="bg-white rounded shadow-sm p-4 p-md-5 mb-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="h4 fw-bold">
          <i class="fa-solid fa-file-circle-plus"></i>
          Rascunhos
        </h2>
      </div>
      {% if posts_rascunhos %}
      <div class="list-group">
        {% for post in posts_rascunhos %}
        <div class="list-group-item">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ post.titulo }}</h5>
            <small class="text-muted"
              >Criado em {{ post.criado_em|date:"d/m/Y" }}</small
            >
          </div>
          <p class="mb-1 text-muted">{{ post.conteudo|truncatewords:20 }}</p>
          <small class="text-warning mb-2 d-block"
            >Rascunho - Não publicado</small
          >
          <a
            href="{% url 'blog:editar_post' post.slug %}"
            class="btn btn-sm btn-primary"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-pencil me-1"
              viewBox="0 0 16 16"
            >
              <path
                d="M12.146.292a.513.513 0 0 1 .723 0l2.839 2.839a.513.513 0 0 1 0 .723l-10.851 10.851a.513.513 0 0 1-.723 0L.292 2.975a.513.513 0 0 1 0-.723L3.131.292a.513.513 0 0 1 .723 0l3.467 3.467 5.725-5.725zm-.074 10.631a.5.5 0 0 0 0 .707L13.293 15H2.5a.5.5 0 0 0 0 1h11.5a.5.5 0 0 0 .354-.146l3.146-3.147a.5.5 0 0 0 0-.707l-2.839-2.838a.5.5 0 0 0-.707 0l-2.839 2.838z"
              />
            </svg>
            Editar
          </a>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-muted text-center py-4">Você não tem rascunhos.</p>
      {% endif %}
    </div>

    <!-- Comentários Pendentes -->
    {% if total_comentarios_pendentes > 0 %}
    <div class="bg-white rounded shadow-sm p-4 p-md-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="h4 fw-bold">
          <i class="fa-solid fa-file-circle-exclamation"></i>
          Comentários Pendentes
        </h2>
      </div>
      <div class="list-group">
        {% for comentario in comentarios_pendentes %}
        <div class="list-group-item">
          <div class="d-flex w-100 justify-content-between">
            <h6 class="mb-1">
              <strong>{{ comentario.nome }}</strong> em
              <a href="{{ comentario.post.get_absolute_url }}"
                >{{ comentario.post.titulo }}</a
              >
            </h6>
            <small class="text-muted"
              >{{ comentario.criado_em|date:"d/m/Y H:i" }}</small
            >
          </div>
          <p class="mb-1 mt-2">{{ comentario.mensagem|truncatewords:30 }}</p>
          <small class="text-danger">Aguardando aprovação</small>
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
