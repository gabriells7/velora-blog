{% extends 'base.html' %} {% block title %} â€“ Dashboard{% endblock %} 
{% block content %}
<div class="container-fluid py-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <h1 class="display-5 fw-bold">
          <i class="fas fa-chart-line me-3"></i>Dashboard
        </h1>
        <a href="{% url 'blog:novo_post' %}" class="btn btn-primary btn-lg">
          <i class="fas fa-plus me-2"></i>Novo Post
        </a>
      </div>
    </div>
  </div>

  <!-- EstatÃ­sticas principais -->
  <div class="row mb-4">
    <!-- Posts Publicados -->
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-white rounded shadow-sm h-100">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6 class="text-muted mb-2 fw-semibold">Posts Publicados</h6>
              <h2 class="fw-bold text-primary mb-0">
                {{ total_posts_publicados }}
              </h2>
            </div>
            <div class="p-3 bg-primary bg-opacity-10 rounded">
              <i class="fas fa-file-alt fa-2x text-primary"></i>
            </div>
          </div>
          <small class="text-muted">
            <i class="fas fa-arrow-up me-1"></i>Artigos ativos
          </small>
        </div>
      </div>
    </div>

    <!-- Posts Rascunho -->
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-white rounded shadow-sm h-100">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6 class="text-muted mb-2 fw-semibold">Rascunhos</h6>
              <h2 class="fw-bold text-warning mb-0">
                {{ total_posts_rascunhos }}
              </h2>
            </div>
            <div class="p-3 bg-warning bg-opacity-10 rounded">
              <i class="fas fa-pen-fancy fa-2x text-warning"></i>
            </div>
          </div>
          <small class="text-muted">
            <i class="fas fa-clock me-1"></i>Aguardando publicaÃ§Ã£o
          </small>
        </div>
      </div>
    </div>

    <!-- Total de ComentÃ¡rios -->
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-white rounded shadow-sm h-100">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6 class="text-muted mb-2 fw-semibold">ComentÃ¡rios Recebidos</h6>
              <h2 class="fw-bold text-success mb-0">
                {{ total_comments_received }}
              </h2>
            </div>
            <div class="p-3 bg-success bg-opacity-10 rounded">
              <i class="fas fa-comments fa-2x text-success"></i>
            </div>
          </div>
          <small class="text-muted">
            <i class="fas fa-arrow-up me-1"></i>InteraÃ§Ã£o dos leitores
          </small>
        </div>
      </div>
    </div>

    <!-- MÃ©dia por Post -->
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-white rounded shadow-sm h-100">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6 class="text-muted mb-2 fw-semibold">
                MÃ©dia de ComentÃ¡rios/Post
              </h6>
              <h2 class="fw-bold text-info mb-0">
                {{ avg_comments_per_post|floatformat:1 }}
              </h2>
            </div>
            <div class="p-3 bg-info bg-opacity-10 rounded">
              <i class="fas fa-chart-pie fa-2x text-info"></i>
            </div>
          </div>
          <small class="text-muted">
            <i class="fas fa-calculation me-1"></i>Por artigo publicado
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- GrÃ¡fico e EstatÃ­sticas -->
  <div class="row mb-4">
    <!-- GrÃ¡fico de Posts por MÃªs -->
    <div class="col-lg-8 mb-3">
      <div class="card bg-white rounded shadow-sm">
        <div class="card-header border-bottom py-3 px-4">
          <h5 class="mb-0 fw-bold">
            <i class="fas fa-chart-bar me-2"></i>Posts Publicados nos Ãšltimos 6
            Meses
          </h5>
        </div>
        <div class="card-body p-4">
          <canvas id="monthlyChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Resumo -->
    <div class="col-lg-4 mb-3">
      <div class="card bg-white rounded shadow-sm">
        <div class="card-header border-bottom py-3 px-4">
          <h5 class="mb-0 fw-bold">
            <i class="fas fa-info-circle me-2"></i>Resumo
          </h5>
        </div>
        <div class="card-body p-4">
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-2">
              <span class="fw-semibold">MÃ©dia Mensal (6 meses)</span>
              <span class="text-primary fw-bold"
                >{{ avg_posts_last_6_months|floatformat:1 }}</span
              >
            </div>
            <small class="text-muted d-block">Posts por mÃªs</small>
          </div>
          <hr />
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-2">
              <span class="fw-semibold">Total (6 meses)</span>
              <span class="text-success fw-bold"
                >{% widthratio posts_by_month|length 6 1 %}</span
              >
            </div>
            <small class="text-muted d-block">Posts em 6 meses</small>
          </div>
          <hr />
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-2">
              <span class="fw-semibold">Taxa de Engajamento</span>
              <span class="text-info fw-bold">
                {% if total_posts_publicados > 0 %} {{
                engagement_rate|default:"N/A" }}% {% else %} N/A {% endif %}
              </span>
            </div>
            <small class="text-muted d-block">ComentÃ¡rios por post</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Posts Publicados -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card bg-white rounded shadow-sm">
        <div class="card-header border-bottom py-3 px-4">
          <h5 class="mb-0 fw-bold">
            <i class="fas fa-newspaper me-2"></i>Posts Recentes (Publicados)
          </h5>
        </div>
        <div class="card-body p-4">
          {% if posts_publicados %}
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead>
                <tr class="border-bottom">
                  <th class="fw-bold text-muted" style="width: 40%">TÃ­tulo</th>
                  <th class="fw-bold text-muted" style="width: 20%">Data</th>
                  <th class="fw-bold text-muted" style="width: 15%">
                    Categoria
                  </th>
                  <th class="fw-bold text-muted" style="width: 15%">AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody>
                {% for post in posts_publicados %}
                <tr>
                  <td>
                    <a
                      href="{% url 'blog:detalhe_post' post.slug %}"
                      class="text-decoration-none fw-semibold"
                    >
                      {{ post.titulo|truncatewords:8 }}
                    </a>
                  </td>
                  <td>
                    <small class="text-muted">
                      {{ post.publicado_em|date:"d/m/Y H:i" }}
                    </small>
                  </td>
                  <td>
                    {% if post.categoria %}
                    <span class="badge bg-secondary"
                      >{{ post.categoria.nome }}</span
                    >
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                  </td>
                  <td>
                    <a
                      href="{% url 'blog:detalhe_post' post.slug %}"
                      class="btn btn-sm btn-outline-primary"
                      title="Visualizar"
                    >
                      <i class="fas fa-eye"></i>
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-5">
            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
            <p class="text-muted">Nenhum post publicado ainda</p>
            <a href="{% url 'blog:novo_post' %}" class="btn btn-primary">
              Criar Primeiro Post
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Rascunhos -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card bg-white rounded shadow-sm">
        <div class="card-header border-bottom py-3 px-4">
          <h5 class="mb-0 fw-bold">
            <i class="fas fa-drafts me-2"></i>Rascunhos
          </h5>
        </div>
        <div class="card-body p-4">
          {% if posts_rascunhos %}
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead>
                <tr class="border-bottom">
                  <th class="fw-bold text-muted" style="width: 40%">TÃ­tulo</th>
                  <th class="fw-bold text-muted" style="width: 20%">
                    Criado em
                  </th>
                  <th class="fw-bold text-muted" style="width: 15%">
                    Categoria
                  </th>
                  <th class="fw-bold text-muted" style="width: 15%">AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody>
                {% for post in posts_rascunhos %}
                <tr>
                  <td>
                    <a
                      href="{% url 'blog:editar_post' post.slug %}"
                      class="text-decoration-none fw-semibold"
                    >
                      {{ post.titulo|truncatewords:8 }}
                    </a>
                  </td>
                  <td>
                    <small class="text-muted">
                      {{ post.criado_em|date:"d/m/Y H:i" }}
                    </small>
                  </td>
                  <td>
                    {% if post.categoria %}
                    <span class="badge bg-secondary"
                      >{{ post.categoria.nome }}</span
                    >
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                  </td>
                  <td>
                    <a
                      href="{% url 'blog:editar_post' post.slug %}"
                      class="btn btn-sm btn-outline-warning"
                      title="Editar"
                    >
                      <i class="fas fa-edit"></i>
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-5">
            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
            <p class="text-muted">Nenhum rascunho. VocÃª estÃ¡ em dia! ðŸŽ‰</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<script>
  // GrÃ¡fico de Posts por MÃªs
  const ctx = document.getElementById('monthlyChart').getContext('2d');
  const monthlyData = {
    {% for month in posts_by_month %}
      {% if month.count %}
        '{{ month.month }}/{{ month.year }}': {{ month.count }},
      {% endif %}
    {% endfor %}
  };

  const monthLabels = [
    {% for month in posts_by_month %}
      '{% if month.month == 1 %}Jan{% elif month.month == 2 %}Fev{% elif month.month == 3 %}Mar{% elif month.month == 4 %}Abr{% elif month.month == 5 %}Mai{% elif month.month == 6 %}Jun{% elif month.month == 7 %}Jul{% elif month.month == 8 %}Ago{% elif month.month == 9 %}Set{% elif month.month == 10 %}Out{% elif month.month == 11 %}Nov{% else %}Dez{% endif %}/{{ month.year|slice:"2:" }}'{{ forloop.last|yesno:",," }}
    {% endfor %}
  ];

  const monthCounts = [
    {% for month in posts_by_month %}
      {{ month.count }}{{ forloop.last|yesno:",," }}
    {% endfor %}
  ];

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: monthLabels,
      datasets: [
        {
          label: 'Posts Publicados',
          data: monthCounts,
          backgroundColor: '#0d6efd',
          borderColor: '#0d6efd',
          borderRadius: 5,
          borderSkipped: false,
          hoverBackgroundColor: '#0b5ed7',
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          display: true,
          position: 'top',
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          titleFont: { size: 12 },
          bodyFont: { size: 12 },
          cornerRadius: 4,
        },
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1,
          },
          grid: {
            drawBorder: false,
            color: 'rgba(0, 0, 0, 0.05)',
          },
        },
        x: {
          grid: {
            display: false,
          },
        },
      },
    },
  });
</script>
{% endblock %}
